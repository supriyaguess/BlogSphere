<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  <title>Blog</title>
</head>

<body>
  <%- include('./partials/nav') %>

  <!-- Blog Content -->
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        <h1 class="fw-bold mb-3"><%= blog.title %></h1>

        <img
          src="<%= blog.coverImageURL %>"
          class="img-fluid rounded mb-4"
          alt="Blog cover"
        />

        <div class="blog-body">
          <pre><%= blog.body %></pre>
        </div>

        <!-- Author -->
        <div class="d-flex align-items-center gap-3 mt-4">
          <% if (blog.createdBy.profileImageURL && blog.createdBy.profileImageURL !== '/images/default.png') { %>
            <img
              src="<%= blog.createdBy.profileImageURL %>"
              width="45"
              height="45"
              class="rounded-circle"
              style="object-fit: cover"
            />
          <% } else { %>
            <div 
              class="rounded-circle d-inline-flex align-items-center justify-content-center"
              style="width: 45px; height: 45px; background-color: <%= getColorFromName(blog.createdBy.fullName) %>;"
            >
              <span style="color: white; font-size: 18px; font-weight: bold;">
                <%= getInitials(blog.createdBy.fullName) %>
              </span>
            </div>
          <% } %>
          <div>
            <strong><%= blog.createdBy.fullName %></strong>
            <div class="text-muted small">Author</div>
          </div>
        </div>

        <hr class="my-4" />

        <!-- Comments -->
        <h4 class="fw-semibold mb-3">
          Comments (<%= comments.length %>)
        </h4>

        <% if (user) { %>
          <form
            action="/blog/comment/<%= blog._id %>"
            method="post"
            class="mb-4"
          >
            <textarea
              name="content"
              class="form-control mb-2"
              rows="3"
              placeholder="Write a comment..."
              required
            ></textarea>
            <button class="btn btn-primary btn-sm">
              Add Comment
            </button>
          </form>
        <% } else { %>
          <p>
            <a href="/user/signin">Login</a> to add a comment.
          </p>
        <% } %>

        <!-- Comment List -->
        <div>
          <% comments.forEach(comment => { %>
            <div class="d-flex gap-3 mb-3">
              <% if (comment.createdBy.profileImageURL && comment.createdBy.profileImageURL !== '/images/default.png') { %>
                <img
                  src="<%= comment.createdBy.profileImageURL %>"
                  width="40"
                  height="40"
                  class="rounded-circle"
                  style="object-fit: cover"
                />
              <% } else { %>
                <div 
                  class="rounded-circle d-inline-flex align-items-center justify-content-center flex-shrink-0"
                  style="width: 40px; height: 40px; background-color: <%= getColorFromName(comment.createdBy.fullName) %>;"
                >
                  <span style="color: white; font-size: 16px; font-weight: bold;">
                    <%= getInitials(comment.createdBy.fullName) %>
                  </span>
                </div>
              <% } %>
              <div class="bg-light rounded p-2 w-100">
                <strong><%= comment.createdBy.fullName %></strong>
                <pre class="mb-0"><%= comment.content %></pre>
              </div>
            </div>
          <% }) %>
        </div>

      </div>
    </div>
  </div>

  <%- include('./partials/scripts') %>
</body>
</html>
