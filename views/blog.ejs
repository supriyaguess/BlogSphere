<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title>Blog</title>
  </head>
  <body>
    <%- include('./partials/nav') %>

    <div class="container mt-4">
      <h1><%= blog.title %></h1>
      <img
        src="<%= blog.coverImageURL %>"
        class="img-fluid rounded mb-3"
        width="700px"
      />
      <pre class="mt-3"><%= blog.body %></pre>
    </div>

    <!-- Blog Author -->
    <div class="container mt-4 d-flex align-items-center gap-2">
      <img 
        src="<%= blog.createdBy.profileImageURL %>" 
        width="40" 
        height="40"
        style="object-fit: cover; border-radius: 50%;" 
      />
      <strong><%= blog.createdBy.fullName %></strong>
    </div>

    <!-- Comments -->
    <div class="container mt-3">   
      <h3>Comments (<%= comments.length %>)</h3>

      <% if (user) { %> 
        <form action="/blog/comment/<%= blog._id %>" method="post">
          <div class="mt-3">
            <input
              type="text"
              name="content"
              class="form-control"
              placeholder="Enter your comments"
            />
            <button class="btn btn-sm btn-primary mt-2" type="submit">
              Add
            </button>
          </div>
        </form>
      <% } else { %>
        <p>
          <a href="/user/signin">Login</a> to add a comment.
        </p>
      <% } %>

      <div class="mt-4">
        <% comments.forEach(comment => { %>
          <div class="mb-3 d-flex gap-2 align-items-start">
            <img 
              src="<%= comment.createdBy.profileImageURL %>" 
              width="35" 
              height="35"
              style="object-fit: cover; border-radius: 50%;" 
            />
            <div>
              <strong><%= comment.createdBy.fullName %></strong>
              <pre class="mb-0"><%= comment.content %></pre>
            </div>
          </div>
        <% }) %>
      </div>
    </div>

    <%- include('./partials/scripts') %>
  </body>
</html>
